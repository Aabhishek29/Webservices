# E-commerce Cart & Order Management API Documentation

## Overview
This is a comprehensive e-commerce API that handles cart management, wishlist, orders, and transactions with user-specific operations.

## Key Features
- ✅ User-specific cart operations with userId parameter
- ✅ Professional error handling and response format
- ✅ Comprehensive order management system
- ✅ Transaction tracking and history
- ✅ Admin order status management
- ✅ Pagination support
- ✅ Search and filtering capabilities
- ✅ Detailed order status history
- ✅ Proper permission checks

## Authentication
All endpoints require authentication using JWT tokens or session authentication.

## Response Format
All API responses follow a consistent format:

```json
{
    "success": true/false,
    "message": "Success or error message",
    "data": {}, // Response data
    "errors": {} // Validation errors (if any)
}
```

---

## 🛒 CART ENDPOINTS

### 1. Get User's Cart
```http
GET /api/cart/{user_id}/
```

**Response:**
```json
{
    "success": true,
    "data": {
        "cartId": "uuid",
        "user": "user_id",
        "items": [
            {
                "id": 1,
                "product": {
                    "productId": "uuid",
                    "name": "Product Name",
                    "price": "99.99",
                    "image": "image_url"
                },
                "quantity": 2,
                "unit_price": "99.99",
                "total_price": "199.98"
            }
        ],
        "total_items": 2,
        "total_amount": "199.98",
        "items_count": 1
    }
}
```

### 2. Add Item to Cart
```http
POST /api/cart/add/
Content-Type: application/json

{
    "user_id": "uuid",
    "product_id": "uuid",
    "quantity": 2
}
```

**Response:**
```json
{
    "success": true,
    "message": "Item added to cart successfully",
    "data": {
        // Updated cart object
    }
}
```

### 3. Update Cart Item
```http
PUT /api/cart/{user_id}/update/{item_id}/
Content-Type: application/json

{
    "quantity": 3
}
```

### 4. Remove Item from Cart
```http
DELETE /api/cart/{user_id}/remove/{item_id}/
```

### 5. Clear Cart
```http
DELETE /api/cart/{user_id}/clear/
```

---

## ❤️ WISHLIST ENDPOINTS

### 1. Get User's Wishlist
```http
GET /api/wishlist/{user_id}/
```

### 2. Add to Wishlist
```http
POST /api/wishlist/add/
Content-Type: application/json

{
    "product_id": "uuid"
}
```

### 3. Remove from Wishlist
```http
DELETE /api/wishlist/{user_id}/remove/{product_id}/
```

### 4. Clear Wishlist
```http
DELETE /api/wishlist/{user_id}/clear/
```

---

## 📦 ORDER ENDPOINTS

### 1. Get Order History
```http
GET /api/orders/{user_id}/?status=PENDING&search=ORD-2024&page=1&page_size=20
```

**Query Parameters:**
- `status`: Filter by order status
- `payment_status`: Filter by payment status
- `search`: Search by order number or product name
- `date_from`: Filter orders from date (YYYY-MM-DD)
- `date_to`: Filter orders to date (YYYY-MM-DD)
- `page`: Page number
- `page_size`: Items per page

**Response:**
```json
{
    "success": true,
    "data": [
        {
            "orderId": "uuid",
            "orderNumber": "ORD-2024-000001",
            "status": "PENDING",
            "paymentStatus": "PENDING",
            "totalAmount": "199.98",
            "items": [
                {
                    "product_name": "Product Name",
                    "quantity": 2,
                    "unitPrice": "99.99"
                }
            ],
            "createdAt": "2024-01-01T00:00:00Z"
        }
    ],
    "count": 1,
    "next": null,
    "previous": null
}
```

### 2. Get Order Details
```http
GET /api/orders/{user_id}/{order_id}/
```

**Response includes:**
- Complete order information
- Order items
- Shipping and billing addresses
- Status history
- Transaction details

### 3. Create Order from Cart
```http
POST /api/orders/create/
Content-Type: application/json

{
    "user_id": "uuid",
    "shipping_address_id": "uuid",
    "billing_address_id": "uuid", // optional
    "notes": "Special instructions",
    "is_gift": false,
    "gift_message": ""
}
```

### 4. Cancel Order
```http
POST /api/orders/{user_id}/{order_id}/cancel/
```

### 5. Update Order Status (Admin Only)
```http
PATCH /api/orders/{order_id}/status/
Content-Type: application/json

{
    "status": "SHIPPED",
    "notes": "Order shipped via FedEx",
    "tracking_id": "1234567890"
}
```

**Available Statuses:**
- `PENDING` - Initial status
- `CONFIRMED` - Order confirmed
- `PROCESSING` - Being processed
- `PACKED` - Ready for shipping
- `SHIPPED` - Shipped
- `OUT_FOR_DELIVERY` - Out for delivery
- `DELIVERED` - Delivered
- `CANCELLED` - Cancelled
- `RETURNED` - Returned

---

## 💳 TRANSACTION ENDPOINTS

### 1. Get Transaction History
```http
GET /api/transactions/{user_id}/
```

**Response:**
```json
{
    "success": true,
    "data": [
        {
            "transactionId": "uuid",
            "order_number": "ORD-2024-000001",
            "status": "SUCCESS",
            "amount": "199.98",
            "currency": "INR",
            "razorpay_payment_id": "pay_xxxxx",
            "createdAt": "2024-01-01T00:00:00Z"
        }
    ]
}
```

---

## 🔧 USAGE EXAMPLES

### Frontend Integration Example (JavaScript)

```javascript
// Add item to cart
const addToCart = async (userId, productId, quantity = 1) => {
    try {
        const response = await fetch('/api/cart/add/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                user_id: userId,
                product_id: productId,
                quantity: quantity
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            console.log('Item added to cart:', data.message);
            updateCartUI(data.data);
        } else {
            console.error('Error:', data.errors);
        }
    } catch (error) {
        console.error('Network error:', error);
    }
};

// Get user's cart
const getCart = async (userId) => {
    try {
        const response = await fetch(`/api/cart/${userId}/`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            displayCart(data.data);
        }
    } catch (error) {
        console.error('Error fetching cart:', error);
    }
};

// Create order
const createOrder = async (orderData) => {
    try {
        const response = await fetch('/api/orders/create/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(orderData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            console.log('Order created:', data.data.orderNumber);
            redirectToPayment(data.data.orderId);
        } else {
            console.error('Order creation failed:', data.errors);
        }
    } catch (error) {
        console.error('Network error:', error);
    }
};
```

### Python/Django Integration Example

```python
import requests
from django.conf import settings

class EcommerceAPI:
    def __init__(self, base_url, token):
        self.base_url = base_url
        self.headers = {
            'Authorization': f'Bearer {token}',
            'Content-Type': 'application/json'
        }
    
    def add_to_cart(self, user_id, product_id, quantity=1):
        """Add item to user's cart"""
        url = f"{self.base_url}/cart/add/"
        data = {
            'user_id': str(user_id),
            'product_id': str(product_id),
            'quantity': quantity
        }
        
        response = requests.post(url, json=data, headers=self.headers)
        return response.json()
    
    def get_cart(self, user_id):
        """Get user's cart"""
        url = f"{self.base_url}/cart/{user_id}/"
        response = requests.get(url, headers=self.headers)
        return response.json()
    
    def create_order(self, order_data):
        """Create order from cart"""
        url = f"{self.base_url}/orders/create/"
        response = requests.post(url, json=order_data, headers=self.headers)
        return response.json()

# Usage
api = EcommerceAPI('https://api.example.com', 'your-jwt-token')

# Add item to cart
result = api.add_to_cart('user-uuid', 'product-uuid', 2)
if result['success']:
    print(f"Added to cart: {result['message']}")

# Create order
order_data = {
    'user_id': 'user-uuid',
    'shipping_address_id': 'address-uuid',
    'notes': 'Handle with care'
}
order_result = api.create_order(order_data)
```

---

## 🛡️ PERMISSIONS & SECURITY

### Permission Levels:
1. **User Level**: Can access their own cart, wishlist, and orders
2. **Admin Level**: Can access all data and update order statuses

### Security Features:
- User ID validation in URL parameters
- Permission checks for cross-user access
- Input validation and sanitization
- Atomic transactions for data consistency
- Comprehensive error handling

---

## 📊 ADMIN FEATURES

### Django Admin Integration:
- Custom admin interfaces for all models
- Bulk actions for order management
- Detailed order tracking and history
- Transaction monitoring
- User activity insights

### Admin Actions:
- Mark orders as shipped
- Mark orders as delivered
- View detailed transaction logs
- Export order data

---

## 🚀 DEPLOYMENT NOTES

### Database Migrations:
```bash
python manage.py makemigrations
python manage.py migrate
```

### Required Dependencies:
```
Django>=4.0
djangorestframework>=3.14
django-cors-headers
drf-spectacular  # for API documentation
```

### Settings Configuration:
```python
INSTALLED_APPS = [
    # ... other apps
    'rest_framework',
    'corsheaders',
    'drf_spectacular',
    'carts',  # your app name
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 20
}
```

This API provides a comprehensive e-commerce solution with professional-grade features and proper user management through userId parameters in URLs.